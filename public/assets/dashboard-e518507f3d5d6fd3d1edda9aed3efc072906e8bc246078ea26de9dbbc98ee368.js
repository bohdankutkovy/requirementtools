$(function(){function e(){var e=$("#project_select_id option:selected").val();t("/projects/"+e)}function t(e){$.get(e,function(e){$("#myFrame").html(e),$("#version_table").hide()})}function o(e){return $.ajax({type:"POST",url:e+"/clear",success:function(e){t(e.page),r()}}),!1}function n(e,o){$.ajax({type:"POST",url:o,data:e,dataType:"JSON",processData:!1,contentType:!1,success:function(e){t(e.page),r()},error:function(e,t,o){var n=e.responseText.split("\n");alert(n[2])}})}function c(e){return $.ajax({type:"POST",url:e,success:function(e){t(e.page),r()}}),!1}function r(){var e=$("#project_select_id option:selected").val();$.ajax("requirements",{type:"GET",dataType:"json",data:{project_id:e},success:function(e){project_id=$("#project_select_id option:selected").val(),$.isNumeric(project_id)?$("#project_assign").attr("href","/assignments/"+project_id):($("#project_select_modal option:selected").removeAttr("selected"),$("#project_modal").modal("show"),$("#project_assign").removeAttr("href")),buildRequirementsTree(e.requirements)}})}r(),e(),$(document).on("change","#project_select_id",function(t){r(),e()}),$(document).on("change","#project_select_modal",function(e){$("#project_modal").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),$("#project_select_id").val($("#project_select_modal option:selected").val()).trigger("change")}),$(document).on("click",".frame-link",function(e){e.preventDefault(),t($(this).attr("href"))}),$(document).on("click",".delete-frame-link",function(e){e.preventDefault(),o($(this).attr("href"))}),$(document).on("click",".create-frame-link",function(e){e.preventDefault(),n($(this).attr("href"))}),$(document).on("click",".version-frame-link",function(e){e.preventDefault(),c($(this).attr("href"))}),$(document).on("submit","form.new_assignment",function(e){e.preventDefault(),n(new FormData($(this)[0]),$(this).attr("action"))}),$(document).on("submit","form.edit_assignment",function(e){e.preventDefault(),n(new FormData($(this)[0]),$(this).attr("action"))}),$(document).on("submit","form.new_requirement",function(e){e.preventDefault(),n(new FormData($(this)[0]),$(this).attr("action")),r()}),$(document).on("submit","form.edit_requirement",function(e){e.preventDefault(),n(new FormData($(this)[0]),$(this).attr("action")),r()}),$(document).on("submit","form.new_attachment",function(e){e.preventDefault(),$("#myModal").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),n(new FormData($(this)[0]),$(this).attr("action"))}),$(document).ready(function(){$.isNumeric($("#project_select_id option:selected").val())?($("#project_assign").show(),$(".tree_block").show("slow")):($("#project_select_modal option:selected").removeAttr("selected"),$("#project_modal").modal("show"),$("#project_assign").hide(),$(".tree_block").hide())}),$(document).on("change","#project_select_id",function(e){$.isNumeric($("#project_select_id option:selected").val())?($("#project_assign").show(),$(".tree_block").show("slow")):($("#project_select_modal option:selected").removeAttr("selected"),$("#project_modal").modal("show"),$("#project_assign").hide(),$(".tree_block").hide("slow"))}),$(document).on("click",".fileupload",function(e){e.preventDefault(),$("form.edit_requirement").submit()}),$(document).on("click","#version_toggler",function(e){e.preventDefault(),$("#version_table").toggle()})});